<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Wedding Photo Upload</title>

<style>
/* ---------------- GLOBAL ---------------- */
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  background: #faf7f5;
  color: #333;
  overflow: hidden;
}

#bgVideo {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: -1;
}

/* ---------------- LAYOUT ---------------- */
.container {
  height: 100vh;
  display: flex;
  flex-direction: column;
  padding: 20px;
  text-align: center;
}

h1 {
  font-size: 2rem;
  margin: 8px 0;
  letter-spacing: 2px;
}

p {
  font-size: 1.4rem;
  margin-bottom: 16px;
}

/* ---------------- BUTTONS ---------------- */
.upload-btn, button {
  padding: 14px 24px;
  border-radius: 12px;
  border: none;
  font-weight: 600;
  background: linear-gradient(90deg, #eecda3, #ef629f);
  color: white;
  cursor: pointer;
}

input[type="file"] {
  display: none;
}

/* ---------------- SCROLL CONTAINER ---------------- */
#scrollContainer {
  flex: 1;
  overflow-y: auto;
  margin-top: 16px;
  -webkit-overflow-scrolling: touch;
}

/* ---------------- ULTRA MOBILE GRID ---------------- */
.preview {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(96px, 1fr));
  gap: 10px;
  contain: strict;
  content-visibility: auto;
}

/* ITEM */
.preview > div {
  position: relative;
  height: 96px;
  overflow: hidden;
  contain: strict;
  will-change: transform, opacity;
  transform: translateZ(0);
}

/* IMAGE */
.preview img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  opacity: 1;
  transition: opacity 160ms ease-out;
}

.preview img.low-quality {
  opacity: 0.45;
}

/* DELETE BUTTON */
.preview button {
  position: absolute;
  top: 2px;
  right: 2px;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: rgba(239,98,159,0.95);
  color: #fff;
  font-size: 1.1rem;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* INSTANT DELETE */
.preview > div.removing {
  opacity: 0;
  transform: scale(0.92);
  transition: opacity 140ms ease-out, transform 140ms ease-out;
  pointer-events: none;
}
</style>
</head>

<body>

<video autoplay muted loop id="bgVideo">
  <source src="videos/BG.mp4" type="video/mp4" />
</video>

<div class="container">
  <h1>Petros & Christina</h1>
  <p>June 20 2026</p>

  <label class="upload-btn">
    Select Photos
    <input type="file" id="fileInput" accept="image/*" multiple />
  </label>

  <div id="scrollContainer">
    <div class="preview" id="preview"></div>
  </div>

  <button onclick="uploadPhotos()">Upload</button>
</div>

<script>
/* ---------------- VIDEO ---------------- */
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('bgVideo').playbackRate = 0.4;
});

/* ---------------- STATE ---------------- */
const fileInput = document.getElementById('fileInput');
const preview = document.getElementById('preview');
const scrollContainer = document.getElementById('scrollContainer');

const ITEM_SIZE = 106;
const BUFFER = 8;

let selectedFiles = [];
let objectURLs = new Map();

/* ---------------- FILE INPUT ---------------- */
fileInput.addEventListener('change', () => {
  selectedFiles.push(...Array.from(fileInput.files));
  updateVirtualGrid();
});

/* ---------------- VIRTUAL GRID ---------------- */
scrollContainer.addEventListener(
  'scroll',
  () => requestAnimationFrame(updateVirtualGrid),
  { passive: true }
);

function updateVirtualGrid() {
  const scrollTop = scrollContainer.scrollTop;
  const height = scrollContainer.clientHeight;
  const cols = Math.max(1, Math.floor(preview.clientWidth / ITEM_SIZE));

  const startRow = Math.floor(scrollTop / ITEM_SIZE);
  const visibleRows = Math.ceil(height / ITEM_SIZE);

  const start = Math.max(0, (startRow - BUFFER) * cols);
  const end = (startRow + visibleRows + BUFFER) * cols;

  renderItems(start, end, cols);
}

/* ---------------- RENDER ---------------- */
function renderItems(start, end, cols) {
  preview.innerHTML = '';

  for (let i = start; i < end; i++) {
    const file = selectedFiles[i];
    if (!file) continue;

    const wrapper = document.createElement('div');
    const img = document.createElement('img');
    const btn = document.createElement('button');

    img.className = 'low-quality';
    btn.textContent = 'âœ•';

    btn.onclick = () => removeItem(wrapper, i);

    const url = URL.createObjectURL(file);
    objectURLs.set(i, url);
    img.src = url;

    img.onload = () => img.classList.remove('low-quality');

    wrapper.append(img, btn);
    preview.appendChild(wrapper);
  }

  preview.style.height =
    Math.ceil(selectedFiles.length / cols) * ITEM_SIZE + 'px';
}

/* ---------------- DELETE ---------------- */
function removeItem(wrapper, index) {
  selectedFiles[index] = null;
  wrapper.classList.add('removing');

  setTimeout(() => {
    wrapper.remove();
    const url = objectURLs.get(index);
    if (url) setTimeout(() => URL.revokeObjectURL(url), 2000);
    objectURLs.delete(index);
  }, 150);
}

/* ---------------- UPLOAD ---------------- */
function uploadPhotos() {
  const files = selectedFiles.filter(Boolean);
  if (!files.length) {
    alert('Please select at least one photo');
    return;
  }
  alert(`Ready to upload ${files.length} photos`);
}
</script>

</body>
</html>
